namespace Charjs {
    export class PointEffect extends AbstractEffect {
        cchars = [[[0, 16], [1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 0, 5], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [2, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 3, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 1, 2, 3, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 0, 4], [2, 3, 0, 1, 2, 3, 0, 1, 2, 4, 0, 4]], [[0, 16], [1, 1, 2, 1, 1, 1, 2, 1, 1, 3, 2, 1, 1, 3, 0, 5], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 3, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [2, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [0, 2, 1, 1, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 0, 4], [0, 2, 2, 1, 0, 1, 2, 3, 0, 1, 2, 4, 0, 4]], [[0, 16], [1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 0, 5], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 3, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 0, 4], [1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 0, 4], [2, 3, 0, 1, 2, 3, 0, 1, 2, 4, 0, 4]], [[0, 16], [0, 2, 1, 1, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1], [0, 1, 1, 2, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [0, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [0, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [0, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [0, 2, 1, 1, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1], [0, 2, 2, 1, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 4]], [[0, 16], [1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [2, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 3, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 1, 2, 3, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1], [2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 4]], [[0, 16], [1, 1, 2, 1, 1, 1, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 3, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [2, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [0, 2, 1, 1, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1], [0, 2, 2, 1, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 4]], [[0, 16], [1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 3, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1], [1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1, 1, 3, 2, 1], [2, 3, 0, 1, 2, 3, 0, 1, 2, 3, 0, 1, 2, 4]], [[0, 2, 2, 2, 0, 2, 2, 2, 0, 1, 2, 1, 0, 1, 2, 4, 0, 1], [0, 1, 2, 1, 3, 2, 2, 2, 3, 2, 2, 1, 3, 1, 2, 1, 3, 3, 2, 2], [2, 1, 3, 3, 2, 2, 3, 2, 2, 1, 3, 1, 2, 1, 3, 2, 2, 1, 3, 1, 2, 1], [2, 2, 3, 2, 2, 2, 3, 2, 2, 1, 3, 1, 2, 1, 3, 2, 2, 1, 3, 1, 2, 1], [0, 1, 2, 1, 3, 2, 2, 2, 3, 2, 2, 1, 3, 1, 2, 1, 3, 3, 2, 2], [0, 1, 2, 1, 3, 2, 2, 2, 3, 4, 2, 1, 3, 2, 2, 2, 0, 1], [0, 1, 2, 1, 3, 2, 2, 3, 3, 2, 2, 2, 3, 2, 2, 1, 0, 2], [0, 1, 2, 4, 0, 1, 2, 4, 0, 1, 2, 3, 0, 2]]];
        chars = null;
        colors = ['', '#fff', '#000', '#f00'];
        // cchars = null;
        // chars = [
        //     [// 200
        //         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 0, 0, 0, 0, 0],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 2, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 0, 0, 0, 0],
        //         [2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2, 0, 0, 0, 0]
        //     ], [ // 400
        //         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        //         [1, 2, 1, 2, 1, 1, 1, 2, 1, 1, 1, 0, 0, 0, 0, 0],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [0, 0, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 0, 0, 0, 0],
        //         [0, 0, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2, 0, 0, 0, 0]
        //     ], [ // 800
        //         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 0, 0, 0, 0, 0],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 0, 0, 0, 0],
        //         [2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2, 0, 0, 0, 0]
        //     ], [ // 1000
        //         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        //         [0, 0, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2],
        //         [0, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [0, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [0, 0, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [0, 0, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2],
        //         [0, 0, 2, 0, 2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2]
        //     ], [ // 2000
        //         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 2, 2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2],
        //         [2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2]
        //     ], [ // 4000
        //         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        //         [1, 2, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [2, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [0, 0, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2],
        //         [0, 0, 2, 0, 2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2]
        //     ], [ // 8000
        //         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        //         [1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 1, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2],
        //         [1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 2],
        //         [2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2]
        //     ], [ // 1UP
        //         [0, 0, 2, 2, 0, 0, 2, 2, 0, 2, 0, 2, 2, 2, 2, 0],
        //         [0, 2, 3, 3, 2, 2, 3, 3, 2, 3, 2, 3, 3, 3, 2, 2],
        //         [2, 3, 3, 3, 2, 2, 3, 3, 2, 3, 2, 3, 3, 2, 3, 2],
        //         [2, 2, 3, 3, 2, 2, 3, 3, 2, 3, 2, 3, 3, 2, 3, 2],
        //         [0, 2, 3, 3, 2, 2, 3, 3, 2, 3, 2, 3, 3, 3, 2, 2],
        //         [0, 2, 3, 3, 2, 2, 3, 3, 3, 3, 2, 3, 3, 2, 2, 0],
        //         [0, 2, 3, 3, 2, 2, 2, 3, 3, 2, 2, 3, 3, 2, 0, 0],
        //         [0, 2, 2, 2, 2, 0, 2, 2, 2, 2, 0, 2, 2, 2, 0, 0],
        //     ]
        // ];

        onPushedUp(player: IPlayer) { }
        onStepped(player: IPlayer) { }

        init(): PointEffect {
            super.init();
            return this;
        }

        private static staticEffect: PointEffect = null;

        public static drawPoint(targetDom: HTMLElement, pos: IPosition, pointIndex: number, pixSize: number) {
            if (!PointEffect.staticEffect) {
                PointEffect.staticEffect = new PointEffect(targetDom, pixSize);
                PointEffect.staticEffect.init();
            }
            PointEffect.staticEffect.drawEffect(pos, pointIndex);
        }

        drawEffect(_pos: IPosition, pointIndex: number) {
            if (pointIndex >= this.chars.length)
                pointIndex = this.chars.length - 1;

            let pos = JSON.parse(JSON.stringify(_pos));

            let count = 0;
            let effect = this.draw(pointIndex, pos, undefined, undefined, true, undefined, true);
            let tEffect = this.getTimer(() => {
                if (count < 8)
                    pos.y += 4 * this.pixSize;
                else
                    pos.y += 1 * this.pixSize;

                if (count >= 20) {
                    this.removeCharacter(effect);
                    this.destroy();
                    this.removeTimer(tEffect);
                } else {
                    this.move(effect, pos);
                    count++;
                }
            }, this.frameInterval * 2);

        }

        private move(target: HTMLCanvasElement, pos: IPosition) {
            target.style.left = pos.x + 'px';
            target.style.bottom = pos.y + 'px';
        }
    }
}